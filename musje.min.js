!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Snap"),require("MIDI")):"function"==typeof define&&define.amd?define(["Snap","MIDI"],e):"object"==typeof exports?exports.musje=e(require("Snap"),require("MIDI")):t.musje=e(t.Snap,t.MIDI)}(this,function(t,e){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var n=i(1),r=i(3),s=i(22),a=i(2),o=i(45);r.prototype.render=function(t,e){new s(t,e).render(this)},a.defineProperties(r.prototype,o),t.exports={parse:function(t){var e=n.parse(t);return new r(e)},Score:r}},function(t,e,i){var n=function(){function t(t){return t[t.length-1]}function e(t){return t[Object.keys(t)[0]]}function n(t){var e=t.length;return","===t.charAt(0)?-e:e}function r(e){var i=e.parts;i&&i.forEach(function(e){var i=t(e.measures);0===i.data.length&&e.measures.pop()})}function s(){this.yy={}}var a=function(t,e,i,n){for(i=i||{},n=t.length;n--;i[t[n]]=e);return i},o=[1,11],h=[1,15],u=[1,16],c=[1,17],l=[1,18],f=[1,19],d=[1,20],p=[1,23],y=[1,27],g=[1,34],m=[1,35],_=[1,33],b=[1,28],v=[1,29],x=[5,9,10,14,21,22,23,24,25,26,29,34,39,41,48,51,58],w=[2,8],S=[5,9,10,21,22,23,24,25,26,29,34,39,41,48,51,58],k=[5,21,22,23,24,25,26],E=[2,47],P=[1,48],I=[1,49],D=[1,50],C=[1,51],T=[1,52],B=[5,9,10,21,22,23,24,25,26,28,29,34,35,39,41,48,51,53,58],L=[5,9,10,21,22,23,24,25,26,28,29,34,35,39,41,43,44,45,46,47,48,51,53,58],$=[5,9,10,21,22,23,24,25,26,28,29,34,35,39,41,43,44,45,46,47,48,50,51,53,58],O=[1,63],N=[1,64],R=[5,21,22,23,24,25,26,29,34,39,41,48,51,58],W=[5,9,10,21,22,23,24,25,26,28,29,34,35,39,41,43,48,51,53,58],A=[5,9,10,21,22,23,24,25,26,28,29,34,39,41,48,51,53,58],j=[39,41,50],z={trace:function(){},yy:{},symbols_:{0:29,error:2,e:3,maybe_musje:4,EOF:5,space:6,maybe_space:7,musje:8,S:9,NL:10,score_head:11,part_list:12,title:13,TITLE:14,COMPOSER:15,part:16,measure_list:17,bar:18,measure:19,music_data:20,"|":21,"||":22,"|]":23,"|:":24,":|":25,":|:":26,slurable:27,TIE:28,maybe_duration:30,voice:31,time_signature:32,pitchful:33,"(":34,")":35,note:36,chord:37,pitch:38,STEP:39,OCTAVE:40,ACCIDENTAL:41,type_modifier:42,DOT:43,_:44,"=":45,HALF:46,WHOLE:47,"<":48,pitch_list:49,">":50,"{":51,voice_list:52,"}":53,voice_data_list:54,":":55,voice_data:56,restslurable_list:57,BEATS:58,BEAT_TYPE:59,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",9:"S",10:"NL",14:"TITLE",15:"COMPOSER",21:"|",22:"||",23:"|]",24:"|:",25:":|",26:":|:",28:"TIE",29:"0",34:"(",35:")",39:"STEP",40:"OCTAVE",41:"ACCIDENTAL",43:"DOT",44:"_",45:"=",46:"HALF",47:"WHOLE",48:"<",50:">",51:"{",53:"}",54:"voice_data_list",55:":",57:"restslurable_list",58:"BEATS",59:"BEAT_TYPE"},productions_:[0,[3,2],[4,0],[4,2],[4,3],[4,1],[6,1],[6,1],[7,0],[7,2],[7,2],[8,1],[8,1],[8,2],[11,2],[13,1],[13,2],[12,1],[16,1],[16,3],[17,1],[17,4],[17,3],[19,2],[19,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[20,1],[20,2],[20,2],[20,1],[20,1],[27,2],[27,3],[27,3],[27,4],[33,1],[33,1],[36,1],[38,1],[38,2],[38,2],[38,3],[30,0],[30,1],[30,1],[30,2],[42,1],[42,1],[42,2],[42,2],[42,3],[42,3],[42,1],[42,1],[37,3],[49,1],[49,2],[31,3],[52,1],[52,3],[56,1],[56,2],[32,2]],performAction:function(i,s,a,o,h,u,c){var l=u.length-1;switch(h){case 1:return u[l-1];case 2:case 3:this.$=null;break;case 4:case 5:this.$=u[l],r(u[l]);break;case 10:this.$=u[l-1]?u[l-1]+1:1;break;case 11:this.$={head:u[l]};break;case 12:this.$={parts:u[l]};break;case 13:this.$={head:u[l-1],parts:u[l]};break;case 15:this.$={title:u[l]};break;case 16:this.$={title:u[l-1],composer:u[l]};break;case 17:case 60:case 63:this.$=[u[l]];break;case 18:this.$={measures:u[l]};break;case 19:this.$={measures:u[l]},u[l][0].data.unshift({bar:u[l-2]});break;case 20:this.$=[u[l]];break;case 21:this.$=u[l-3],t(u[l-3]).data.push({bar:u[l-2]}),u[l-3].push(u[l]);break;case 22:this.$=u[l-2],t(u[l-2]).data.push({bar:u[l-1]}),u[l-2].push({data:[]});break;case 23:this.$={data:[u[l-1]]};break;case 24:this.$=u[l-2],u[l-2].data.push(u[l-1]);break;case 25:this.$="single";break;case 26:this.$="double";break;case 27:this.$="end";break;case 28:this.$="repeat-begin";break;case 29:this.$="repeat-end";break;case 30:this.$="repeat-both";break;case 32:this.$=u[l-1],e(u[l-1]).tie="~";break;case 33:this.$={rest:{duration:u[l]}};break;case 34:this.$={voice:u[l]};break;case 36:this.$=u[l-1],e(u[l-1]).duration=u[l];break;case 37:this.$=u[l-1],F(e(u[l-1]),{duration:u[l],slur:{begin:"solid"}});break;case 38:this.$=u[l-2],F(e(u[l-2]),{duration:u[l-1],slur:{end:"solid"}});break;case 39:this.$=u[l-2],F(e(u[l-2]),{duration:u[l-1],slur:{begin:"solid",end:"solid"}});break;case 40:this.$={note:u[l]};break;case 41:this.$={chord:u[l]};break;case 42:this.$={pitch:u[l]};break;case 43:this.$={step:+u[l]};break;case 44:this.$={step:+u[l-1],octave:n(u[l])};break;case 45:this.$={accidental:u[l-1],step:+u[l]};break;case 46:this.$={accidental:u[l-2],step:+u[l-1],octave:n(u[l])};break;case 48:this.$={type:u[l]};break;case 49:this.$={type:4,dot:u[l].length};break;case 50:this.$={type:u[l-1],dot:u[l].length};break;case 51:this.$=8;break;case 52:this.$=16;break;case 53:this.$=32;break;case 54:this.$=64;break;case 55:this.$=128;break;case 56:this.$=256;break;case 57:this.$=2;break;case 58:this.$=1;break;case 59:this.$={pitches:u[l-1]};break;case 61:case 66:this.$=u[l-1],u[l-1].push(u[l]);break;case 62:this.$=u[l-1];break;case 64:this.$=u[l-2],u[l-2].push(u[l-1]);break;case 67:this.$={time:{beats:+u[l-1],beatType:+u[l]}}}},table:[{3:1,4:2,5:[2,2],6:3,8:4,9:[1,5],10:[1,6],11:7,12:8,13:9,14:o,16:10,17:12,18:13,19:14,20:21,21:h,22:u,23:c,24:l,25:f,26:d,27:22,29:p,31:24,32:25,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_,51:b,58:v},{1:[3]},{5:[1,36]},a(x,w,{7:37}),{5:[2,5]},a(x,[2,6]),a(x,[2,7]),{5:[2,11],12:38,16:10,17:12,18:13,19:14,20:21,21:h,22:u,23:c,24:l,25:f,26:d,27:22,29:p,31:24,32:25,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_,51:b,58:v},{5:[2,12]},a(S,w,{7:39}),{5:[2,17]},a(S,[2,15],{15:[1,40]}),{5:[2,18],18:41,21:h,22:u,23:c,24:l,25:f,26:d},a([9,10,29,34,39,41,48,51,58],w,{7:42}),a(k,[2,20],{27:22,31:24,32:25,33:26,36:30,37:31,38:32,20:43,29:p,34:y,39:g,41:m,48:_,51:b,58:v}),a(S,[2,25]),a(S,[2,26]),a(S,[2,27]),a(S,[2,28]),a(S,[2,29]),a(S,[2,30]),a(S,w,{7:44}),a(S,[2,31],{28:[1,45]}),a(S,E,{30:46,42:47,43:P,44:I,45:D,46:C,47:T}),a(S,[2,34]),a(S,[2,35]),a(B,E,{42:47,30:53,43:P,44:I,45:D,46:C,47:T}),{33:54,36:30,37:31,38:32,39:g,41:m,48:_},{52:55,54:[1,56]},{59:[1,57]},a(L,[2,40]),a(L,[2,41]),a(L,[2,42]),{38:59,39:g,41:m,49:58},a($,[2,43],{40:[1,60]}),{39:[1,61]},{1:[2,1]},{5:[2,3],8:62,9:O,10:N,11:7,12:8,13:9,14:o,16:10,17:12,18:13,19:14,20:21,21:h,22:u,23:c,24:l,25:f,26:d,27:22,29:p,31:24,32:25,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_,51:b,58:v},{5:[2,13]},a(R,[2,14],{9:O,10:N}),a(S,[2,16]),a(S,w,{7:65}),{9:O,10:N,17:66,19:14,20:21,27:22,29:p,31:24,32:25,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_,51:b,58:v},a(S,w,{7:67}),a(R,[2,23],{9:O,10:N}),a(S,[2,32]),a(S,[2,33]),a(B,[2,48],{43:[1,68]}),a(B,[2,49]),a(W,[2,51]),a(W,[2,52],{44:[1,69],45:[1,70]}),a(W,[2,57]),a(W,[2,58]),a(A,[2,36],{35:[1,71]}),a(B,E,{42:47,30:72,43:P,44:I,45:D,46:C,47:T}),{53:[1,73]},{53:[2,63],55:[1,74]},a(S,[2,67]),{38:76,39:g,41:m,50:[1,75]},a(j,[2,60]),a($,[2,44]),a($,[2,45],{40:[1,77]}),{5:[2,4]},a(x,[2,9]),a(x,[2,10]),a(k,[2,22],{20:21,27:22,31:24,32:25,33:26,36:30,37:31,38:32,19:78,9:O,10:N,29:p,34:y,39:g,41:m,48:_,51:b,58:v}),{5:[2,19],18:41,21:h,22:u,23:c,24:l,25:f,26:d},a(R,[2,24],{9:O,10:N}),a(B,[2,50]),a(W,[2,53]),a(W,[2,54],{44:[1,79],45:[1,80]}),a(A,[2,38]),a(A,[2,37],{35:[1,81]}),a(S,[2,62]),{27:83,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_,56:82,57:[1,84]},a(L,[2,59]),a(j,[2,61]),a($,[2,46]),a(k,[2,21],{27:22,31:24,32:25,33:26,36:30,37:31,38:32,20:43,29:p,34:y,39:g,41:m,48:_,51:b,58:v}),a(W,[2,55]),a(W,[2,56]),a(A,[2,39]),{53:[2,64]},{53:[2,65]},{27:85,33:26,34:y,36:30,37:31,38:32,39:g,41:m,48:_},{53:[2,66]}],defaultActions:{4:[2,5],8:[2,12],10:[2,17],36:[2,1],38:[2,13],62:[2,4],82:[2,64],83:[2,65],85:[2,66]},parseError:function(t,e){function i(t,e){this.message=t,this.hash=e}if(!e.recoverable)throw i.prototype=Error,new i(t,e);this.trace(t)},parse:function(t){var e=this,i=[0],n=[null],r=[],s=this.table,a="",o=0,h=0,u=0,c=2,l=1,f=r.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(p.yy[y]=this.yy[y]);d.setInput(t,p.yy),p.yy.lexer=d,p.yy.parser=this,"undefined"==typeof d.yylloc&&(d.yylloc={});var g=d.yylloc;r.push(g);var m=d.options&&d.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,b,v,x,w,S,k,E,P,I=function(){var t;return t=d.lex()||l,"number"!=typeof t&&(t=e.symbols_[t]||t),t},D={};;){if(v=i[i.length-1],this.defaultActions[v]?x=this.defaultActions[v]:(null!==_&&"undefined"!=typeof _||(_=I()),x=s[v]&&s[v][_]),"undefined"==typeof x||!x.length||!x[0]){var C="";P=[];for(S in s[v])this.terminals_[S]&&S>c&&P.push("'"+this.terminals_[S]+"'");C=d.showPosition?"Parse error on line "+(o+1)+":\n"+d.showPosition()+"\nExpecting "+P.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(o+1)+": Unexpected "+(_==l?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(C,{text:d.match,token:this.terminals_[_]||_,line:d.yylineno,loc:g,expected:P})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+_);switch(x[0]){case 1:i.push(_),n.push(d.yytext),r.push(d.yylloc),i.push(x[1]),_=null,b?(_=b,b=null):(h=d.yyleng,a=d.yytext,o=d.yylineno,g=d.yylloc,u>0&&u--);break;case 2:if(k=this.productions_[x[1]][1],D.$=n[n.length-k],D._$={first_line:r[r.length-(k||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(k||1)].first_column,last_column:r[r.length-1].last_column},m&&(D._$.range=[r[r.length-(k||1)].range[0],r[r.length-1].range[1]]),w=this.performAction.apply(D,[a,h,o,p.yy,x[1],n,r].concat(f)),"undefined"!=typeof w)return w;k&&(i=i.slice(0,-1*k*2),n=n.slice(0,-1*k),r=r.slice(0,-1*k)),i.push(this.productions_[x[1]][0]),n.push(D.$),r.push(D._$),E=s[i[i.length-2]][i[i.length-1]],i.push(E);break;case 3:return!0}}return!0}},F=i(2).extend,H=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,n,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),n=t[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var s in r)this[s]=r[s];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,n;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length;s++)if(i=this._input.match(this.rules[r[s]]),i&&(!e||i[0].length>e[0].length)){if(e=i,n=s,this.options.backtrack_lexer){if(t=this.test_match(i,r[s]),t!==!1)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,r[n]),t!==!1?t:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,n){switch(i){case 0:return 9;case 1:return 9;case 2:return 9;case 3:this.begin("title");break;case 4:return e.yytext=e.yytext.substr(0,e.yyleng-2).trim(),14;case 5:this.begin("INITIAL");break;case 6:return this.begin("INITIAL"),e.yytext=e.yytext.trim(),15;case 7:return this.begin("time"),e.yytext=e.yytext.substr(0,e.yyleng-1),58;case 8:return this.begin("INITIAL"),59;case 9:return 41;case 10:return 39;case 11:return 40;case 12:return 43;case 13:return 47;case 14:return 46;case 15:return 28;case 16:return 44;case 17:return 45;case 18:return".";case 19:return 29;case 20:return 48;case 21:return 50;case 22:return 34;case 23:return 35;case 24:return"/";case 25:return"\\";case 26:return 23;case 27:return 22;case 28:return"[|";case 29:return 24;case 30:return 26;case 31:return 25;case 32:return 21;case 33:return 51;case 34:return 53;case 35:return 55;case 36:return 10;case 37:return 9;case 38:return 5;case 39:return"INVALID"}},rules:[/^(?:\/\/[^\n]*)/,/^(?:\/\*([\s\S]*?)\*\/)/,/^(?:\/\*[\s\S]*)/,/^(?:<<)/,/^(?:.*>>)/,/^(?:([ \t])*([\n\r]))/,/^(?:.*)/,/^(?:(([1-9]\d{0,2})\/))/,/^(?:([1-9]\d{0,2})[^\d])/,/^(?:(#{1,2}|n|b{1,2}))/,/^(?:[1-7])/,/^(?:,+|'+)/,/^(?:\.+)/,/^(?:( *- *){3})/,/^(?:( *- *))/,/^(?: *~)/,/^(?:[_])/,/^(?:=)/,/^(?:\.)/,/^(?:[0])/,/^(?:<)/,/^(?:>)/,/^(?:\()/,/^(?:\))/,/^(?:\/)/,/^(?:\\)/,/^(?:\|\])/,/^(?:\|\|)/,/^(?:\[\|)/,/^(?:\|:)/,/^(?::\|:)/,/^(?::\|)/,/^(?:\|)/,/^(?:\{)/,/^(?:\})/,/^(?::)/,/^(?:([\n\r]))/,/^(?:([ \t]))/,/^(?:$)/,/^(?:.)/],conditions:{time:{rules:[8],inclusive:!1},title:{rules:[4,5,6],inclusive:!1},INITIAL:{rules:[0,1,2,3,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],inclusive:!0}}};return t}();return z.lexer=H,s.prototype=z,z.Parser=s,new s}();t.exports=n},function(t,e){"use strict";function i(t){var e=typeof t;return"function"===e||"object"===e&&!!t}var n=Object.defineProperty,r={},s=r.objEach=function(t,e){i(t)&&Object.keys(t).forEach(function(i){e(t[i],i)})};r.extend=function(t,e){return s(e,function(e,i){t[i]=e}),t},r.near=function(t,e){return Math.abs(t-e)<1e-5},r.defineProperties=function(t,e){s(e,function(e,i){var r,s=typeof e;r="object"!==s||"function"!=typeof e.get&&"function"!=typeof e.set?"function"===s||"$type"===i?{value:e}:{value:e,writable:!0,enumerable:!0}:e,n(t,i,r)})},r.toJSONWithDefault=!0,r.makeToJSON=function(t,e){return function(){if(!this.isEmpty){var i=this,n={};if(s(t,function(t,e){(r.toJSONWithDefault||i[e]!==t)&&(n[e]=i[e])}),!e)return n;var a={};return a[e]=n,a}}},t.exports=r},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(4),a=i(5),o=i(20);r.defineProperties(n.prototype,{head:{get:function(){return this._head||(this._head=new s)},set:function(t){this._head=new s(t)}},parts:{get:function(){return this._parts||(this._parts=new a(this))},set:function(t){this.parts.removeAll(),this.parts.addParts(t),this.measures.fromPartwise()}},measures:{get:function(){return this._measures||(this._measures=new o(this))}},toString:function(){return this.head+this.parts.map(function(t){return t.toString()}).join("\n\n")},toJSON:r.makeToJSON({head:void 0,parts:void 0}),walkCells:function(t){this.parts.forEach(function(e,i){e.measures.forEach(function(e,n){t(e,n,i)})})},walkMusicData:function(t){this.walkCells(function(e,i,n){e.data.forEach(function(e,r){t(e,r,i,n)})})}}),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2);r.defineProperties(n.prototype,{title:void 0,subtitle:void 0,subsubtitle:void 0,composer:void 0,arranger:void 0,lyricist:void 0,isEmpty:{get:function(){return!(this.title||this.subtitle||this.subsubtitle||this.composer||this.arranger||this.lyricist)}},toString:function(){return""+(this.title?"<<"+this.title+">>":"")+(this.composer||"")+"\n"},toJSON:r.makeToJSON({title:void 0,subtitle:void 0,subsubtitle:void 0,composer:void 0,lyricist:void 0})}),t.exports=n},function(t,e,i){"use strict";function n(t){var e=[];return e._score=t,r.defineProperties(e,a),e}var r=i(2),s=i(6),a={score:{get:function(){return this._score}},addParts:function(t){var e=this;t.forEach(function(t){e.append(t)})},append:function(t){var e=this.length,i=new s(e,this);this.push(i),i.measures=t.measures},removeAll:function(){this.length=0}};t.exports=n},function(t,e,i){"use strict";function n(t,e){this._index=t,this._parts=e}var r=i(2),s=i(7);r.defineProperties(n.prototype,{parts:{get:function(){return this._parts}},measures:{get:function(){return this._measures||(this._measures=[])},set:function(t){var e=this._index,i=this.parts.score,n=this._measures=[];t.forEach(function(t,r){n.push(new s(t,r,e,i))})}},toString:function(){return this.measures.map(function(t){return t}).join(" ")},toJSON:r.makeToJSON({measures:void 0})}),t.exports=n},function(t,e,i){"use strict";function n(t,e){function i(){return e>r&&!a(r,e)}function n(){s.length>1&&o.push(s),s=[]}var r=0,s=[],o=[];return t.data.forEach(function(t){if("Note"===t.$type||"Rest"===t.$type){var o=t.duration,h=o.quarter;r+=h,i()?o.underbar&&s.push(t):a(r,e)?(s.push(t),n(),r=0):(n(),r%=e)}}),n(),o}function r(t,e,i,n){this._mIndex=e,this._pIndex=i,this._score=n,s.extend(this,t),this.makeBeams(1)}var s=i(2),a=s.near,o=i(8),h={time:i(9),bar:i(11),note:i(12),rest:i(17),chord:i(18),voice:i(19)};s.defineProperties(r.prototype,{score:{get:function(){return this._score}},data:{get:function(){return this._data||(this._data=[])},set:function(t){var e=this;e.length=0,t.forEach(function(t){e.append(t)})}},measures:{get:function(){return this.score.measures}},measure:{get:function(){return this.measures[this._mIndex]}},parts:{get:function(){return this.score.parts}},part:{get:function(){return this.parts[this._pIndex]}},prev:{get:function(){return this.part.measures[this._mIndex-1]}},next:{get:function(){return this.part.measures[this._mIndex+1]}},firstData:{get:function(){return this.data[0]}},lastData:{get:function(){return this.data[this.data.length-1]}},barLeft:{get:function(){var t=this.firstData;if(t&&"Bar"===t.$type)return t;var e=this.prev;return e?e.barRight:void 0}},barRight:{get:function(){var t=this.lastData;return t&&"Bar"===t.$type?t:void 0}},append:function(t){var e=Object.keys(t)[0],i=new h[e](t[e]);i.cell=this,i._index=this.data.length,this.data.push(i)},toString:function(){return this.data.map(function(t){return t.toString()}).join(" ")},toJSON:s.makeToJSON({data:void 0}),makeBeams:function(t){n(this,t).forEach(function(t){function e(e,i){var n=t[e+1];return n&&n.duration.underbar>i}var i={};t.forEach(function(t,n){var r,s=t.duration.underbar;for(r=0;s>r;r++)e(n,r)?(t.beams=t.beams||[],i[r]?t.beams[r]=new o("continue",r,t):(i[r]=!0,t.beams[r]=new o("begin",r,t))):i[r]&&(t.beams=t.beams||[],t.beams[r]=new o("end",r,t),delete i[r])})})}}),t.exports=r},function(t,e,i){"use strict";function n(t,e,i){this._value=t,this._level=e,this._parent=i}var r=i(2);r.defineProperties(n.prototype,{parent:{get:function(){return this._parent}},value:{get:function(){return this._value}},level:{get:function(){return this._level}},endDurable:{get:function(){for(var t=this.parent.next;t&&"end"!==t.beams[this.level].value;)t=t.next;return t}}}),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(10);r.defineProperties(n.prototype,{$type:"Time",beats:4,beatType:4,toString:function(){return this.beats+"/"+this.beatType},toJSON:r.makeToJSON({beats:4,beatType:4},"time")}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e){"use strict";var i={system:{get:function(){return this.cell.measure.system}},prev:{get:function(){return this.cell.data[this._index-1]}},next:{get:function(){return this.cell.data[this._index+1]}},prevInPart:{get:function(){for(var t=this.prev,e=this.cell;!t&&e.prev;)t||(e=e.prev,t=e.lastData);return t}},nextInPart:{get:function(){for(var t=this.next,e=this.cell;!t&&e.next;)t||(e=e.next,t=e.firstData);return t}},prevDurable:{get:function(){for(var t=this.prev;t&&!t.duration;)t=t.prev;return t}},nextDurable:{get:function(){for(var t=this.next;t&&!t.duration;)t=t.next;return t}},prevDurableInPart:{get:function(){for(var t=this.prevInPart;t&&!t.duration;)t=t.prevInPart;return t}},nextDurableInPart:{get:function(){for(var t=this.nextInPart;t&&!t.duration;)t=t.nextInPart;return t}}};t.exports=i},function(t,e,i){"use strict";function n(t){this.value=t}var r=i(2),s=i(10),a={single:"|","double":"||",end:"|]","repeat-begin":"|:","repeat-end":":|","repeat-both":":|:"};r.defineProperties(n.prototype,{$type:"Bar",value:"single",toString:function(){return a[this.value]},toJSON:function(){return{bar:this.value}}}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(10),a=i(13),o=i(14),h=i(15),u=i(16);r.defineProperties(n.prototype,{$type:"Note",pitch:{get:function(){return this._pitch||(this._pitch=new a(this))},set:function(t){this._pitch=new a(this,t)}},duration:{get:function(){return this._duration||(this._duration=new o)},set:function(t){this._duration=new o(t)}},beams:{get:function(){return this._beams||(this._beams=[])},set:function(t){this._beams=t}},tie:{get:function(){return this._tie||(this._tie=new h(this))},set:function(t){this.tie.value=t}},slur:{get:function(){return this._slur||(this._slur=new u(this))},set:function(t){r.extend(this.slur,t)}},toString:function(){return this.slur.begin+this.pitch+this.duration+this.slur.end+this.tie.value},toJSON:r.makeToJSON({pitch:void 0,duration:void 0,tie:void 0,slur:void 0},"note")}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e,i){"use strict";function n(t,e){return new Array(e+1).join(t)}function r(t){return t>0?n("'",t):0>t?n(",",-t):""}function s(t,e){this._parent=t,a.extend(this,e)}var a=i(2),o=440,h=69,u=[null,0,2,4,5,7,9,11],c={"#":1,"##":2,n:0,b:-1,bb:-2};a.defineProperties(s.prototype,{parent:{get:function(){return this._parent}},step:1,octave:0,accidental:"",alter:{get:function(){if(this.accidental)return c[this.accidental];var t=this.alterLink;return t?t.alter:0}},alterLink:{get:function(){for(var t=this.parent.prev;t;){if("Note"===t.$type&&t.pitch.step===this.step&&t.pitch.accidental)return t.pitch;t=t.prev}}},midiNumber:{get:function(){return 12*(this.octave+5)+u[this.step]+this.alter}},frequency:{get:function(){return o*Math.pow(2,(this.midiNumber-h)/12)}},toString:function(){return this.accidental+this.step+r(this.octave)},toJSON:a.makeToJSON({step:1,octave:0,accidental:""})}),t.exports=s},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s={1:" - - - ",2:" - ",4:"",8:"_",16:"=",32:"=_",64:"==",128:"==_",256:"===",512:"===_",1024:"===="},a={1:0,2:0,4:0,8:1,16:2,32:3,64:4,128:5,256:6,512:7,1024:8},o={0:"",1:".",2:".."};r.defineProperties(n.prototype,{$type:"Duration",type:4,dot:0,quarter:{get:function(){var t=4/this.type;return 0===this.dot?t:1===this.dot?1.5*t:1.75*t}},second:{get:function(){return 60*this.quarter/80}},underbar:{get:function(){return a[this.type]||0}},toString:function(){return s[this.type]+o[this.dot]},toJSON:r.makeToJSON({type:4,dot:0})}),t.exports=n},function(t,e,i){"use strict";function n(t){this._parent=t}var r=i(2);r.defineProperties(n.prototype,{parent:{get:function(){return this._parent}},value:"",begin:{get:function(){return this.value}},end:{get:function(){return this.prevParent}},prevParent:{get:function(){var t=this.parent.prevDurableInPart;return t&&t.tie&&t.tie.value&&t}},nextParent:{get:function(){return this.value&&this.parent.nextDurableInPart}},prevHasError:{get:function(){var t=this.prevParent;return t&&t.pitch?t.pitch&&t.pitch.midiNumber!==this.parent.pitch.midiNumber:!0}},nextHasError:{get:function(){var t=this.nextParent;return t&&t.pitch?t.pitch.midiNumber!==this.parent.pitch.midiNumber:!0}},toJSON:function(){return this.value}}),t.exports=n},function(t,e,i){"use strict";function n(t){this._parent=t}var r=i(2);r.defineProperties(n.prototype,{parent:{get:function(){return this._parent}},begin:"",end:"",prevParent:{get:function(){if(this.end)for(var t=this.parent.prevInPart;t;){if(t.slur&&!t.slur.isEmpty)return t;t=t.prevInPart}}},nextParent:{get:function(){if(this.begin)for(var t=this.parent.nextInPart;t;){if(t.slur&&!t.slur.isEmpty)return t;t=t.nextInPart}}},prevCrossTie:{get:function(){}},nextCrossTie:{get:function(){}},prevHasError:{get:function(){var t=this.prevParent;return!t||!t.slur.begin}},nextHasError:{get:function(){var t=this.nextParent;return!t||!t.slur.end}},isEmpty:{get:function(){return!(this.begin||this.end)}},toJSON:r.makeToJSON({begin:void 0,end:void 0})}),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(10),a=i(14);r.defineProperties(n.prototype,{$type:"Rest",duration:{get:function(){return this._duration||(this._duration=new a)},set:function(t){this._duration=new a(t)}},beams:{get:function(){return this._beams||(this._beams=[])},set:function(t){this._beams=t}},toString:function(){return"0"+this.duration},toJSON:r.makeToJSON({duration:void 0},"rest")}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(10),a=i(13),o=i(14);r.defineProperties(n.prototype,{$type:"Chord",pitches:{get:function(){return this._pitches||(this._pitches=[])},set:function(t){this._pitches=t.map(function(t){return new a(t)})}},duration:{get:function(){return this._duration||(this._duration=new o)},set:function(t){this._duration=new o(t)}},toString:function(){return"<"+this.pitches.map(function(t){return t.toString()}).join("")+">"+this.duration},toJSON:r.makeToJSON({pitches:void 0,duration:void 0},"chord")}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e,i){"use strict";function n(t){r.extend(this,t)}var r=i(2),s=i(10);r.defineProperties(n.prototype,{toString:function(){}}),r.defineProperties(n.prototype,s),t.exports=n},function(t,e,i){"use strict";function n(t){var e=[];return e._score=t,r.defineProperties(e,a),e}var r=i(2),s=i(21),a={score:{get:function(){return this._score}},fromPartwise:function(){var t=this;this.removeAll(),this.score.walkCells(function(e,i){t[i]=t[i]||new s(i,t),t[i].parts.push(e)})},removeAll:function(){this.length=0}};t.exports=n},function(t,e,i){"use strict";function n(t,e){this._measures=e}var r=i(2);r.defineProperties(n.prototype,{measures:{get:function(){return this._measures}},parts:{get:function(){return this._parts||(this._parts=[])},set:function(t){this._parts=t}},barLeft:{get:function(){return this.parts[0].barLeft}},barRight:{get:function(){return this.parts[0].barRight}}}),t.exports=n},function(t,e,i){"use strict";function n(t,e,i){t.el=e.el.g().transform(a.matrix().translate(t.x,t.y)),t.el.use(t.def.pitchDef.el),c(t,i)}function r(t,e){t.data.forEach(function(i){switch(i.$type){case"Rest":n(i,t,e);break;case"Note":n(i,t,e),l("tie",i),l("slur",i);break;case"Time":i.el=t.el.use(i.def.el).attr({x:i.x,y:i.y})}})}function s(t,e){this._lo=o.extend(h.options,e),this.layout=new h(t,this._lo)}var a=i(23),o=i(2),h=i(24),u=i(42),c=i(43),l=i(44);o.defineProperties(s.prototype,{render:function(t){this._score=t,this.layout.flow(t),this.renderHeader(),this.renderContent()},renderHeader:function(){var t=this._lo,e=this.layout.header,i=e.el,n=e.width;i.text(n/2,t.titleFontSize,this._score.head.title).attr({fontSize:t.titleFontSize,fontWeight:t.titleFontWeight,textAnchor:"middle"}),i.text(n,1.5*t.titleFontSize,this._score.head.composer).attr({fontSize:t.composerFontSize,fontWeight:t.composerFontWeight,textAnchor:"end"}),e.height=i.getBBox().height},renderContent:function(){var t=this._lo;this.layout.content.systems.forEach(function(e){var i=e.measures;i.forEach(function(e){u(e,t),e.parts.forEach(function(e){r(e,t)})})})}}),t.exports=s},function(e,i){e.exports=t},function(t,e,i){"use strict";function n(t,e){this.options=e,this.svg=t,this.svg=new o(this),this.body=new h(this),this.header=new u(this),this.content=new c(this),this.defs=new a(this)}var r=i(2),s=i(25),a=i(26),o=i(34),h=i(35),u=i(36),c=i(37),l=i(21),f=i(39),d=i(7),p=i(40),y=i(41);[i(9),i(11),i(12),i(17),i(18),i(19)].forEach(function(t){r.defineProperties(t.prototype,y)}),r.defineProperties(l.prototype,f),r.defineProperties(d.prototype,p),n.options=s,r.defineProperties(n.prototype,{flow:function(t){this._init(t),this.content.flow(t.measures)},_init:function(t){var e=this,i=t.measures;i.forEach(function(t,n){t=i[n],t.layout=e,t.parts.forEach(function(t){t.layout=e,t.flow()})})}}),t.exports=n},function(t,e,i){"use strict";var n=i(2),r={mode:"block",marginTop:25,marginRight:30,marginBottom:25,marginLeft:30,margin:{get:function(){return[this.marginTop,this.marginRight,this.marginBottom,this.marginLeft]},set:function(t){switch(t.length){case 1:return void(this.marginTop=this.marginRight=this.marginBottom=this.marginLeft=t[0]);
case 2:return this.marginTop=this.marginBottom=t[0],void(this.marginRight=this.marginLeft=t[1]);case 4:return this.marginTop=t[0],this.marginRight=t[1],this.marginBottom=t[2],void(this.marginLeft=t[3]);default:throw new Error("Invalid input for margin.")}}},fontSize:20,fontFamily:"Helvetica, Arial, Sans Serif",titleFontSize:"110%",titleFontWeight:"bold",composerFontSize:"90%",composerFontWeight:"bold",timeFontSize:"95%",timeFontWeight:"bold",headerSep:"100%",systemSep:"180%",musicDataSep:"20%",partHeight:"120%",partSep:"80%",measurePaddingLeft:"50%",measurePaddingRight:"50%",barlineHeight:"120%",thinBarlineWidth:"4%",thickBarlineWidth:"16%",barlineSep:"18%",barlineDotRadius:"7.5%",barlineDotSep:"22%",accidentalFontSize:"95%",accidentalShift:"10%",octaveRadius:"6.6%",octaveOffset:"0%",octaveSep:"23%",stepBaselineShift:"12%",typeStrokeWidth:"5%",typebarOffset:"30%",typebarLength:"55%",typebarSep:"45%",typebarExt:"20%",underbarSep:"17%",dotOffset:"60%",dotRadius:"6.6%",dotSep:"60%",t4DotOffset:"30%",t4DotSep:"50%",t4DotExt:"25%",t4DotBaselineShift:"20%"},s=r.fontSize;n.objEach(r,function(t,e){if("string"==typeof t){var i=t.replace(/[\d\.]+/,"");switch(t=+t.replace(/[^\d\.]+/,""),i){case"%":r[e]=s*t/100;break;case"":case"px":r[e]=t;break;case"others to be implemented":}}}),t.exports=r},function(t,e,i){"use strict";function n(t){this._layout=t}var r=i(2),s=i(27),a=i(29),o=i(30),h=i(31),u=i(32),c=i(33),l=i(9),f=i(11),d=i(12),p=i(17),y=i(13),g=i(14);r.defineProperties(l.prototype,c.Time),r.defineProperties(f.prototype,c.Bar),r.defineProperties(d.prototype,c.Note),r.defineProperties(p.prototype,c.Rest),r.defineProperties(y.prototype,c.Pitch),r.defineProperties(g.prototype,c.Duration),r.defineProperties(n.prototype,{get:function(t){var e=t.defId;return this[e]||(this[e]=this._make(e,t))},getAccidental:function(t){var e="a"+t.replace(/#/g,"s");return this[e]||(this[e]=new s(e,t,this._layout))},_make:function(t,e){var i="_make"+e.$type;return this[i](t,e)||{width:0,height:0}},_makeBar:function(t,e){return new a(t,e,this._layout)},_makeTime:function(t,e){return new u(t,e,this._layout)},_makeDuration:function(t,e){return new o(t,e,this._layout)},_getPitch:function(t,e,i){return this[t]||(this[t]=new h(t,e,i,this))},_makeNote:function(t,e){var i=e.duration.underbar,n=e.pitch.defId+i,r=this._getPitch(n,e.pitch,i),s=this.get(e.duration);return{pitchDef:r,durationDef:s,height:r.height,width:r.width+s.width*(i?r.scale.x:1)}},_makeRest:function(t,e){return this._makeNote(t,new d({pitch:{step:0},duration:e.duration}))}}),t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=i.options,a=this.el=i.svg.el.g().attr("id",t),o=e.replace(/bb/,"b"),h=s[o],u=s.ACCIDENTAL_RATIOS[o],c=s.ACCIDENTAL_SHIFTS[o],l=a.path(h),f=a.getBBox();l.transform(r.matrix().translate(.1*n.accidentalShift,-n.accidentalShift).scale(u*n.accidentalFontSize).translate(-f.x,c-f.y2)),"bb"===e&&(a.use(l).attr("x",.24*n.accidentalFontSize),a.transform("scale(0.9,1)")),f=a.getBBox(),this.width=1.2*f.width,a.toDefs()}var r=i(23),s=i(28);t.exports=n},function(t,e){"use strict";var i={"#":"M6.102,7.457V2.753L8.102,2.201V6.881L6.102,7.457zM10.04,6.319L8.665,6.713V2.033L10.04,1.649V-0.295L8.665,0.089V-4.69277H8.102V0.234L6.102,0.809V-3.84077H5.571V0.986L4.196,1.371V3.319L5.571,2.935V7.606L4.196,7.989V9.929L5.571,9.545V14.299L6.102,14.29977V9.375L8.102,8.825V13.45077H8.665V8.651L10.04,8.266V6.319z","##":"M5.009,8.30721C4.27443,8.19192 3.52769,8.19209 2.7858,8.19294C2.77007,7.65011 2.85674,7.0729 2.6415,6.56343C2.49821,6.22426 2.22532,5.95665 1.98269,5.68155C1.59552,6.0278 1.27751,6.48475 1.24704,7.01638C1.21706,7.40767 1.23902,7.80085 1.2322,8.19294C0.4904,8.20416-0.25918,8.16828-0.991,8.314C-0.84988,7.5863-0.88195,6.84171-0.86917,6.1048C-0.3043,6.08953 0.30023,6.17101 0.82484,5.92526C1.13441,5.78023 1.39653,5.55295 1.6591,5.33676C1.3173,4.94965 0.87346,4.60861 0.33665,4.57651C-0.06427,4.54485-0.46734,4.56793-0.86917,4.56097C-0.89434,3.82949-0.80895,3.08855-0.96079,2.3663C-0.23733,2.49697 0.50065,2.46343 1.2322,2.47284C1.24306,2.99383 1.18483,3.53381 1.33191,4.0355C1.44414,4.41838 1.74978,4.71293 2.0051,5.01521C2.36553,4.70111 2.69057,4.30706 2.75011,3.81412C2.804,3.36793 2.76123,2.91977 2.7858,2.47284C3.52263,2.45348 4.28215,2.54713 4.99535,2.314C4.88891,3.05711 4.87889,3.81152 4.88717,4.56097C4.36127,4.57582 3.80954,4.51747 3.30955,4.69457C2.92975,4.8291 2.63114,5.12341 2.32869,5.38325C2.65661,5.71867 3.0516,6.02802 3.5403,6.07368C3.98834,6.11554 4.43829,6.09658 4.88717,6.1048C4.89828,6.83958 4.86193,7.5825 5.009,8.30721z",b:"M8.166,3.657C8.166,4.232 7.950425,4.78273 7.359,5.52188C6.732435,6.30494 6.205,6.75313 5.51,7.28013V3.848C5.668,3.449 5.901,3.126 6.21,2.878C6.518,2.631 6.83,2.507 7.146,2.507C7.668,2.507 7.999,2.803 8.142,3.393C8.158,3.441 8.166,3.529 8.166,3.657zM8.091,1.257C7.66,1.257 7.222,1.376 6.776,1.615C6.33,1.853 5.908,2.172 5.51,2.569V-4.70267H4.947 V7.75213C4.947,8.10413 5.043,8.28013 5.235,8.28013C5.346,8.28013 5.483913,8.18713 5.69,8.06413C6.27334,7.71598 6.636935,7.48332 7.032,7.23788C7.482617,6.95792 7.99,6.631 8.661,5.991C9.124,5.526 9.459,5.057 9.667,4.585C9.874,4.112 9.978,3.644 9.978,3.179C9.978,2.491 9.795,2.002 9.429,1.713C9.015,1.409 8.568,1.257 8.091,1.257z",n:"M 0,14.112V41.52h-1.248V31.248l-6.672,1.728V5.232h1.2v10.704l6.72,-1.824zm-6.72,6.432v7.536l5.472,-1.44v-7.536l-5.472,1.44z",ACCIDENTAL_RATIOS:{"#":.043,n:.023,"##":.062,b:.057},ACCIDENTAL_SHIFTS:{"#":1,n:2,"##":-4,b:0}};t.exports=i},function(t,e){"use strict";function i(t,e,i){var n,r=i.options,s=0;switch(this.el=i.svg.el.g().attr("id",t).toDefs(),e.value){case"single":n=r.thinBarlineWidth,this._addBarline(s,n),s+=n;break;case"double":n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,this._addBarline(s,n),s+=n;break;case"end":n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,n=r.thickBarlineWidth,this._addBarline(s,n),s+=n;break;case"repeat-begin":n=r.thickBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineDotSep+r.barlineDotRadius;break;case"repeat-end":s=r.barlineDotSep+r.barlineDotRadius,n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,n=r.thickBarlineWidth,this._addBarline(s,n),s+=n;break;case"repeat-both":s=r.barlineDotSep+r.barlineDotRadius,n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,n=r.thickBarlineWidth,this._addBarline(s,n),s+=n+r.barlineSep,n=r.thinBarlineWidth,this._addBarline(s,n),s+=n+r.barlineDotSep+r.barlineDotRadius}this.width=s}i.prototype._addBarline=function(t,e){this.el.rect(t,0,e,1)},t.exports=i},function(t,e,i){"use strict";function n(t,e,i){switch(this._id=t,this._layout=i,e.type){case 1:this._makeEl(),this._makeType1(t,e.dot);break;case 2:this._makeEl(),this._makeType2(t,e.dot);break;default:0===e.dot?this.width=0:(this._makeEl(),this._makeType4(t,e.dot))}}var r=i(2);r.defineProperties(n.prototype,{_makeEl:function(){this.el=this._layout.svg.el.g().attr("id",this._id).toDefs()},_addDot:function(t,e,i){var n=this._layout.options;return e>0&&(t+=n.dotOffset*(1===i?1.2:1),this.el.circle(t,0,n.dotRadius)),e>1&&(t+=n.dotSep*(1===i?1.2:1),this.el.circle(t,0,n.dotRadius)),t+n.typebarExt},_makeType1:function(t,e){var i=this._layout.options,n=i.typebarOffset;this._addLine(n),n+=i.typebarLength+i.typebarSep,this._addLine(n),n+=i.typebarLength+i.typebarSep,this._addLine(n),n+=i.typebarLength,this.width=this._addDot(n,e,1)},_addLine:function(t){var e=this._layout.options;this.el.rect(t,-e.typeStrokeWidth,e.typebarLength,e.typeStrokeWidth)},_makeType2:function(t,e){var i=this._layout.options,n=i.typebarOffset;this._addLine(i.typebarOffset),n+=i.typebarLength,this.width=this._addDot(n,e,2)},_makeType4:function(t,e){var i=this._layout.options,n=i.t4DotOffset;this.el.circle(n,-i.t4DotBaselineShift,i.dotRadius),e>1&&(n+=i.t4DotSep,this.el.circle(n,-i.t4DotBaselineShift,i.dotRadius)),this.width=n+i.t4DotExt}}),t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=t.rect(e.x,e.y,e.width,e.height),r=t.g(n);return n.transform(i),e=r.getBBox(),r.remove(),e}function r(t,e,i){var n=Math.abs(e);return{x:Math.pow(.97,n+i+(t?2:0)),y:Math.pow(.95,n+i+(t?1:0))}}function s(t,e,i,s){var a,h,u,c=this._layout=s._layout,l=e.accidental,f=e.octave,d=r(l,f,i),p=this.el=c.svg.el.g().attr({id:t,stroke:"black",strokeWidth:2-(d.x+d.y)});this._defs=s,this._addAccidental(l),this._addStep(e.step),this._addOctave(f),a=this._getMatrix(d,f,i),p.transform(a),h=this._sbbox,h=n(this.el,h,a),u=p.getBBox(),p.toDefs(),o.extend(this,{scale:d,matrix:a,width:u.width,height:-u.y,stepCx:h.cx,stepY:h.y,stepCy:h.cy,stepY2:h.y2,stepTop:f>0?u.y:h.y+.2*c.options.fontSize})}var a=i(23),o=i(2);o.defineProperties(s.prototype,{_addAccidental:function(t){if(!t)return void(this._accidentalX2=0);var e=this._defs.getAccidental(t);this.el.use(e.el).attr("y",-this._layout.options.accidentalShift),this._accidentalX2=e.width},_addStep:function(t){this._sbbox=this.el.text(this._accidentalX2,0,""+t).attr("font-size",this._layout.options.fontSize).getBBox()},_addOctave:function(t){if(t){var e,i=this._layout.options,n=i.octaveRadius,r=i.octaveOffset,s=i.octaveSep,a=this.el.g();if(t>0)for(e=0;t>e;e++)a.circle(this._sbbox.cx,this._sbbox.y+r-s*e,n);else for(e=0;e>t;e--)a.circle(this._sbbox.cx,this._sbbox.y2-r-s*e,n);this.el.add(a)}},_getMatrix:function(t,e,i){var n=this._layout.options,r=this.el.getBBox(),s=(e>=0&&0===i?-n.stepBaselineShift:0)-i*n.underbarSep;return a.matrix().translate(-r.x,s).scale(t.x,t.y).translate(0,o.near(r.y2,this._sbbox.y2)?0:-r.y2)}}),t.exports=s},function(t,e,i){"use strict";function n(t,e,i){var n,s=i.options,a=s.timeFontSize,o=.1*a,h=this.el=i.svg.el.g().attr({id:t,fontSize:a,fontWeight:s.timeFontWeight,textAnchor:"middle"}),u=-.85*a;h.text(0,-1*a,e.beats),h.text(0,0,e.beatType),n=h.getBBox(),h.line(n.x-o,u,n.x2+o,u),h.transform(r.matrix().scale(1,.8).translate(o-n.x,0)),n=h.getBBox(),h.toDefs(),this.width=n.width,this.height=-n.y}var r=i(23);t.exports=n},function(t,e){"use strict";var i={single:"bs","double":"bd",end:"be","repeat-begin":"brb","repeat-end":"bre","repeat-both":"brbe"},n={Time:{defId:{get:function(){return["t",this.beats,"-",this.beatType].join("")}}},Bar:{defId:{get:function(){return i[this.value]}}},Note:{defId:{get:function(){var t=this.pitch,e=this.duration;return["n",t.accidental.replace(/#/g,"s"),t.step,t.octave,e.type,e.dot].join("")}}},Rest:{defId:{get:function(){var t=this.duration;return"r"+t.type+t.dot}}},Pitch:{defId:{get:function(){return["p",this.accidental.replace(/#/g,"s"),this.step,this.octave].join("")}}},Duration:{defId:{get:function(){return"d"+this.type+this.dot}}}};t.exports=n},function(t,e,i){"use strict";function n(t){this._layout=t;var e=t.options;this.el=r(t.svg).attr({fontFamily:e.fontFamily}).addClass("musje"),this.el.clear(),this.width=e.width}var r=i(23),s=i(2);s.defineProperties(n.prototype,{width:{get:function(){return this._w},set:function(t){this._w=t,this.el.attr("width",t);var e=this._layout.body;e&&(e.width=t)}},height:{get:function(){return this._h},set:function(t){this._h=t,this.el.attr("height",t)}}}),t.exports=n},function(t,e,i){"use strict";function n(t){this._layout=t;var e=t.svg,i=t.options;this.el=e.el.g().transform(r.matrix().translate(i.marginLeft,i.marginTop)).addClass("mus-body"),this.width=i.width-i.marginLeft-i.marginRight}var r=i(23),s=i(2);s.defineProperties(n.prototype,{width:{get:function(){return this._w},set:function(t){this._w=t;var e=this._layout;e.header&&(e.header.width=t),e.content&&(e.content.width=t)}},height:{get:function(){return this._h},set:function(t){var e=this._layout,i=e.options;e.svg.height=t+i.marginTop+i.marginBottom,this._h=t}}}),t.exports=n},function(t,e,i){"use strict";function n(t){this._layout=t,this.el=t.body.el.g().addClass("mus-header"),this.width=t.body.width}var r=i(2);r.defineProperties(n.prototype,{width:{get:function(){return this._w},set:function(t){this._w=t}},height:{get:function(){return this._h},set:function(t){this._h=t;var e=this._layout;e.content.y=t?t+e.options.headerSep:0}}}),t.exports=n},function(t,e,i){"use strict";function n(t){this.layout=t,this.el=t.body.el.g().addClass("mus-content"),this.width=t.body.width}var r=i(23),s=i(2),a=i(38);s.defineProperties(n.prototype,{y:{get:function(){return this._y},set:function(t){this._y=t,this.el.transform(r.matrix().translate(0,t)),this._resizeBody()}},width:{get:function(){return this._w},set:function(t){this._w=t}},height:{get:function(){var t=this.systems[this.systems.length-1];return t?t.y+t.height:0}},_resizeBody:function(){var t=this.layout,e=t.header.height;t.body.height=this.height+(e?e+t.options.headerSep:0)},_makeSystems:function(t){var e=this,i=this.layout,n=i.options,r=n.measurePaddingLeft+n.measurePaddingRight,s=new a(i,0),o=this.systems=[s];t.forEach(function(t){var n=t.minWidth+r+(t.barLeftInSystem.width+t.barRightInSystem.width)/2;s.minWidth+n<e.width?s.measures.push(t):(s=new a(i,o.length),o.push(s),s.measures.push(t))})},_maxLengthSystem:{get:function(){var t,e,i=0;for(this.systems.forEach(function(t){i=Math.max(i,t.measures.length)}),t=this.systems.length-1;t>=0;t--)if(e=this.systems[t],e.measures.length===i)return e}},_isNotBalancable:{get:function(){var t=this.systems,e=t.length;return 1===e||2===e&&t[1].minWidth<.4*this.width}},_balanceSystems:function(){if(!this._isNotBalancable){for(var t,e,i=this.systems,n=i[i.length-1],r=this._maxLengthSystem;n.measures.length<r.measures.length-1;){for(;;){if(t=r.next,!t)break;t.measures.unshift(r.measures.pop()),r=t}r=this._maxLengthSystem}for(r=n;r;){for(e=r.prev;r.minWidth>this.width;)e.measures.push(r.measures.shift());r=e}}},flow:function(t){this._makeSystems(t),this._balanceSystems(),this.systems.forEach(function(t){t.flow()})}}),t.exports=n},function(t,e,i){"use strict";function n(t){return t.map(function(t){return{width:t.minWidth,measure:t}}).sort(function(t,e){return e.width-t.width})}function r(t,e){this._index=e,this._layout=t,this.el=t.content.el.g().addClass("mus-system")}var s=i(23),a=i(2);a.defineProperties(r.prototype,{measures:{get:function(){return this._measures||(this._measures=[])}},prev:{get:function(){return this._layout.content.systems[this._index-1]}},next:{get:function(){return this._layout.content.systems[this._index+1]}},y:{get:function(){return this._y},set:function(t){this._y=t,this.el.transform(s.matrix().translate(0,t))}},width:{get:function(){return this._layout.content.width}},minWidth:{get:function(){var t=0;return this.measures.forEach(function(e){t+=e.minWidth}),t}},content:{get:function(){return this._layout.content}},systems:{get:function(){return this.content.systems}},flow:function(){var t=this,e=0,i=0;this._tuneMeasuresWidths(),this.measures.forEach(function(n,r){n.system=t,n._sIndex=r,n.flow(),n.x=i,i+=n.width,e=Math.max(e,n.minHeight)});var n=this.prev;this.y=n?n.y+n.height+this._layout.options.systemSep:0,this.height=e},_isTunable:{get:function(){var t=this.content.width,e=this._index,i=this.systems.length;return i>2||1===i&&this.minWidth>.7*t||2===i&&(0===e||1===e&&this.minWidth>.4*t)}},_tuneMeasuresWidths:function(){if(this._isTunable)for(var t,e=n(this.measures),i=e.length,r=this.width,s=i,a=0;i>a;){if(r>=e[a].width*s){t=r/s;do e[a].measure.width=t,a++;while(i>a);break}t=e[a].width,e[a].measure.width=t,r-=t,a++,s--}}}),t.exports=r},function(t,e,i){"use strict";var n=i(23),r={minWidth:{get:function(){var t=0;return this.parts.forEach(function(e){t=Math.max(t,e.minWidth)}),t+this.padding}},system:{get:function(){return this._s},set:function(t){this._s=t,this.el=t.el.g().addClass("mus-measure")}},padding:{get:function(){var t=this.layout.options;return t.measurePaddingRight+t.measurePaddingLeft}},outerWidth:{get:function(){return this.outerWidthLeft+this.outerWidthRight}},outerWidthLeft:{get:function(){return this.layout.options.measurePaddingLeft+this.barLeftInSystem.width/2}},outerWidthRight:{get:function(){return this.layout.options.measurePaddingRight+this.barRightInSystem.width/2}},width:{get:function(){return this._w||(this._w=this.minWidth)},set:function(t){this._w=t;var e=this.outerWidth;this.parts.forEach(function(i){i.width=t-e})}},height:{get:function(){return this.system.height}},minHeight:{get:function(){var t=0,e=this.layout.options.partSep;return this.parts.forEach(function(i){t+=i.height+e}),t?t-e:0}},x:{get:function(){return this._x},set:function(t){this._x=t,this.el.transform(n.matrix().translate(t,0))}},inSystemBegin:{get:function(){return 0===this._sIndex}},inSystemEnd:{get:function(){return this._sIndex===this.system.measures.length-1}},barLeftInSystem:{get:function(){return this.parts[0].barLeftInSystem}},barRightInSystem:{get:function(){return this.parts[0].barRightInSystem}},flow:function(){var t=this;t.parts.forEach(function(e){e.el=t.el.g().addClass("mus-cell"),e.x=t.outerWidthLeft})},drawBox:function(){return this._boxEl=this.el.rect(0,0,this.width,this.height).attr({stroke:"green",fill:"none"}),this._boxEl},clearBox:function(){this._boxEl.remove(),this._boxEl=void 0}};t.exports=r},function(t,e,i){"use strict";var n=i(23),r=i(11),s={width:{get:function(){return this._w},set:function(t){this._w=t,this._reflow()}},height:{get:function(){return this.layout.options.partHeight}},x:{get:function(){return this._x},set:function(t){this._x=t,this.el.transform(n.matrix().translate(t,this.y2))}},y2:{get:function(){var t=this.layout.options,e=this._pIndex;return e?(e+1)*t.partHeight+e*t.partSep:t.partHeight}},barLeftInSystem:{get:function(){var t=this.barLeft;return t?(this.measure.inSystemBegin&&("end"===t.value||"repeat-end"===t.value?t=new r("single"):"repeat-both"===t.value&&(t=new r("repeat-begin"))),t.def=this.layout.defs.get(t),t):{width:0,height:0}}},barRightInSystem:{get:function(){var t=this.barRight,e=this.measure.system;return t?(e&&this.measure.inSystemEnd&&("repeat-begin"===t.value?t=new r("single"):"repeat-both"===t.value&&(t=new r("repeat-end"))),t.def=this.layout.defs.get(t),t):{width:0,height:0}}},_reflow:function(){var t=this;this.data.forEach(function(e){e.x*=t.width/t.minWidth})},flow:function(){var t,e=this.layout.defs,i=this.layout.options,n=0;this.data.forEach(function(r){var s=r.def=e.get(r);r.x=n,r.y=0,n+=s.width+i.musicDataSep,t=Math.min(t,s.height)}),this.minWidth=n,this.minHeight=t},drawBox:function(){return this._boxEl=this.el.rect(0,-this.height,this.width,this.height).addClass("bbox"),this._boxEl},clearBox:function(){this._boxEl.remove(),this._boxEl=void 0}};t.exports=s},function(t,e){"use strict";var i={x:{get:function(){return this._x},set:function(t){this._x=t,this.el&&this.el.attr("x",t)}},y:{get:function(){return this._y},set:function(t){this._y=t,this.el&&this.el.attr("y",t)}},systemX:{get:function(){return this.x+this.cell.x+this.cell.measure.x}},width:{get:function(){return this.def.width}}};t.exports=i},function(t,e,i){"use strict";function n(t,e,i,n){var r=n/2,s=.15*n;t.circle(e,r-s,i),t.circle(e,r+s,i)}function r(t,e,i){var r=e.el.g().addClass("mus-barline");switch(r.use(t.def.el).transform(o.matrix().scale(1,e.height)),t.value){case"repeat-begin":n(r,t.width-i.barlineDotRadius,i.barlineDotRadius,e.height);break;case"repeat-end":n(r,i.barlineDotRadius,i.barlineDotRadius,e.height);break;case"repeat-both":n(r,t.width-i.barlineDotRadius,i.barlineDotRadius,e.height),n(r,i.barlineDotRadius,i.barlineDotRadius,e.height)}return r}function s(t,e){t.transform(o.matrix().translate(e,0))}function a(t,e){var i,n=t.barRightInSystem;n.def&&(i=r(n,t,e),t.inSystemEnd?s(i,t.width-n.width):s(i,t.width-n.width/2)),t.inSystemBegin&&(n=t.barLeftInSystem,n.def&&r(n,t,e))}var o=i(23);t.exports=a},function(t,e,i){"use strict";function n(t,e,i,n){t.el.line(0,i,e.x-t.x+e.width,i).attr("stroke-width",n.typeStrokeWidth)}function r(t,e){var i=t.def.durationDef,r=t.def.pitchDef,a=t.duration.underbar,o=0;if(t.duration.type<4)t.el.use(i.el).attr({x:r.width,y:r.stepCy});else if(t.duration.dot&&t.el.g().transform(s.matrix().translate(r.width,0)).use(i.el).transform(r.matrix),a)for(var h=0;a>h;h++)t.beams[h]?"begin"===t.beams[h].value&&n(t,t.beams[h].endDurable,o,e):n(t,t,o,e),o-=e.underbarSep}var s=i(23);t.exports=r},function(t,e,i){"use strict";function n(t,e,i,n){var r=i-t,s=n-e,a=0,o=0,u=r,c=s;return h.format("M{x1},{y1}c{c1x},{c1y} {c2x},{c2y} {dx},{dy}c{c3x},{c3y} {c4x},{c4y} {negDx},{negDy}",{x1:t,y1:e,c1x:a,c1y:o-8,c2x:u,c2y:c-8,dx:r,dy:s,c3x:-a,c3y:-o-10,c4x:-u,c4y:-c-10,negDx:-r,negDy:-s})}function r(t,e){var i=t.def.pitchDef.stepCx,r=t.def.pitchDef.stepTop,s=-t.systemX-3,a=t.el.path(n(i,r,s,r-3));return e&&a.addClass("mus-error"),a}function s(t,e){var i=t.def.pitchDef.stepCx,r=t.def.pitchDef.stepTop,s=t.system.width-t.systemX+3,a=t.el.path(n(i,r,s,r-3));return e&&a.addClass("mus-error"),a}function a(t,e,i){var r=t.def.pitchDef.stepCx,s=t.def.pitchDef.stepTop,a=e.def.pitchDef.stepCx,o=e.def.pitchDef.stepTop,h=e.systemX-t.systemX,u=t.el.path(n(r,s,h+a,o));return i&&u.addClass("mus-error"),u}function o(t,e){var i,n,o,h;e[t].end&&(n=e[t].prevParent,o=e[t].prevHasError,n&&n.system===e.system?o&&a(e,n,o):r(e,o)),e[t].begin&&(i=e[t].nextParent,h=e[t].nextHasError,i&&i.system===e.system?a(e,i,h):s(e,h))}var h=i(23);t.exports=o},function(t,e,i){"use strict";function n(t,e){function i(){t.tie.prevParent&&!t.tie.prevHasError||r.noteOn(0,n,100,0),t.tie.nextParent&&!t.tie.nextHasError||r.noteOff(0,n,s),t.el.addClass("mus-playing"),setTimeout(function(){t.el.removeClass("mus-playing")},800*s+100),console.log("Play: "+t,e,s,n)}var n=t.pitch.midiNumber,s=t.duration.second;return setTimeout(i,800*e)}var r=i(46),s=[],a={play:function(){var t=this.parts[0].measures,e=0;t.forEach(function(t){t.data.forEach(function(t){switch(t.$type){case"Note":s.push(n(t,e)),e+=t.duration.second;break;case"Rest":e+=t.duration.second}})})},stop:function(){s.forEach(function(t){clearTimeout(t)}),s=[]}};t.exports=a},function(t,i){t.exports=e}])});